---
tags:
  - lab
  - ctf
  - red_team
module: Host and Networking Penetration Test
topic: System and Host Based Attacks
date: 2025-11-01
status: completed
---
# Objective

Perform system/host-based attacks on the target and capture all the flags hidden within the environment.

**Flags to Capture:**

- **Flag 1**: Check the root ('/') directory for a file that might hold the key to the first flag on target1.ine.local.
- **Flag 2**: In the server's root directory, there might be something hidden. Explore '/opt/apache/htdocs/' carefully to find the next flag on target1.ine.local.
- **Flag 3**: Investigate the user's home directory and consider using 'libssh_auth_bypass' to uncover the flag on target2.ine.local.Â 
- **Flag 4**: The most restricted areas often hold the most valuable secrets. Look into the '/root' directory to find the hidden flag on target2.ine.local.

# Walkthrough

- Ran `ifconfig` and `ping -c 1 target1.ine.local` commands to identify the network information of the attack machine and the victim machine. Confirmed:
	- The IP addresses of both the machines
	- The target machine is online and pingable
	- The machines are in the same subnet

    <img width="788" height="389" alt="1-15  System-Host Based Attack CTF 2 ifconfig" src="https://github.com/user-attachments/assets/3f7f5562-08ba-4a02-88d5-d2c52deebe28" />
    <img width="850" height="209" alt="1-15  System-Host Based Attack CTF 2 ping" src="https://github.com/user-attachments/assets/d66b805a-dad9-43f6-92e3-8371e73a826e" />

- Conduct a nmap scan on target 1.

  <img width="1126" height="764" alt="1-15  System-Host Based Attack CTF 2 nmap-1" src="https://github.com/user-attachments/assets/952c12c3-2beb-4881-bb31-1f1bbc29d287" />

- Search exploits associated to Apache 2.4.6. Nothing usable found

  <img width="1497" height="531" alt="1-15  System-Host Based Attack CTF 2 searchsploit" src="https://github.com/user-attachments/assets/c859c2b4-b571-4156-86d8-2ad90d82a15e" />

- Manually test if the website is vulnerable to ShellShock vulnerability with `curl`. Identified the potential entry

  <img width="782" height="184" alt="1-15  System-Host Based Attack CTF 2 curl test" src="https://github.com/user-attachments/assets/57932ad4-259a-4fdd-8265-42d4af35baef" />

- Launch and set up Burpsuite. We can see the package sending to `http://target1.ine.local/browser.cgi` was intercepted.

  <img width="1508" height="824" alt="1-15  System-Host Based Attack CTF 2 cgi package" src="https://github.com/user-attachments/assets/500d1504-9372-4d11-ab2f-cbe2520ce11c" />

- Send the package to repeater and inject malicious payload here.

  <img width="1178" height="595" alt="1-15  System-Host Based Attack CTF 2 passwd file" src="https://github.com/user-attachments/assets/5274fb9a-3196-4a7e-b49f-22bfa5509c6e" />

- Browse the current directory and found a flag file

  ![1-15  System-Host Based Attack CTF2 files in htdocs](https://github.com/user-attachments/assets/33bd9005-1c5a-4f65-8674-2709a04497b4)

- Obtain the flag 2
  <img width="1184" height="315" alt="1-15  System-Host Based Attack CTF 2 flag 2" src="https://github.com/user-attachments/assets/49ff11dd-0280-4799-9cfd-c01f795a515c" />

- Try exploring upper level file system struture, and find another flag file

  <img width="1192" height="606" alt="1-15  System-Host Based Attack CTF 2 upper file structure" src="https://github.com/user-attachments/assets/5fdcdeaf-6bc7-419e-8e90-3975bb3cbc8c" />

- Obtained the flag 1

  <img width="1194" height="313" alt="1-15  System-Host Based Attack CTF 2 flag 1" src="https://github.com/user-attachments/assets/1c74f48d-ede9-4338-ad6a-12670050c7e5" />

- Now switch to the second target.

  <img width="1126" height="734" alt="1-15  System-Host Based Attack CTF 2 target 2" src="https://github.com/user-attachments/assets/7166802c-7b5f-4afc-a8a6-d62db685e35f" />

- Launch and initially set up msfconsole.

  <img width="593" height="422" alt="1-15  System-Host Based Attack CTF 2 msf setup" src="https://github.com/user-attachments/assets/458e1008-081a-4440-bd4e-d5320467b101" />

- Use `auxiliary/scanner/ssh/libssh_auth_bypass` to gain access to run commands and obtain the flag 3.

  <img width="870" height="754" alt="1-15  System-Host Based Attack CTF 2 flag 3" src="https://github.com/user-attachments/assets/fce30de9-8033-4910-87db-f3ddbd9c5175" />

- Establish a session with the module

  <img width="1061" height="484" alt="1-15  System-Host Based Attack CTF 2 session" src="https://github.com/user-attachments/assets/ac132f94-3a1d-4db1-9935-8abd5e120072" />

- When we try interact with the session created, it's intercepted

  <img width="925" height="338" alt="1-15  System-Host Based Attack CTF 2 session closed" src="https://github.com/user-attachments/assets/469789f7-b7e8-402a-af44-2e8bdf690164" />

- Tried to use `shell-to-meterpreter` to upgrade the session, it failed too.

  <img width="1330" height="342" alt="1-15  System-Host Based Attack CTF 2 failed to upgrade" src="https://github.com/user-attachments/assets/55fbce8d-b317-451f-a38a-262cf46a20e1" />

- We now try upload payload manually through Execute mode to create a new session. First we need to learn the architecture of the target machine. It's critical because it decides what kind of payload we gonna use.

  <img width="1480" height="325" alt="1-15  System-Host Based Attack CTF 2 backdoor upload" src="https://github.com/user-attachments/assets/64d995e0-c724-4393-8656-3dcf8dc06a9d" />

- Create a backdoor file in `/tmp` and launch a http service.

  <img width="1069" height="304" alt="1-15  System-Host Based Attack CTF 2 backdoor" src="https://github.com/user-attachments/assets/fe6bceef-a277-4b59-88aa-0ddf41d49600" />

- Use `curl` command on the target machine to download the backdoor file

  <img width="1480" height="325" alt="1-15  System-Host Based Attack CTF 2 backdoor upload" src="https://github.com/user-attachments/assets/1aae4e90-3b6d-4207-8be7-d9f79e266585" />

- Open msfconsole in another terminal and set a handler module to listen to the port 4444

  <img width="773" height="139" alt="1-15  System-Host Based Attack CTF 2 handler" src="https://github.com/user-attachments/assets/9166a648-2769-477f-ba16-c7e3de55d34f" />

- Back to the previous terminal and run the payload on the target machine

  <img width="853" height="228" alt="1-15  System-Host Based Attack CTF 2 run payload" src="https://github.com/user-attachments/assets/38fea0ee-42db-449c-8e79-b552813f7aa9" />

- Obtained a shell

  <img width="1100" height="181" alt="1-15  System-Host Based Attack CTF 2 shell" src="https://github.com/user-attachments/assets/3ffdc128-45bc-4699-9610-02e7d712cca6" />

- In the user's home directory, `welcome` and `greetings` file are interesting. Both of them are owned by root, but they give us different permissions. What made me interested is `s` permission granted by `welcome`, which potentially allows us to escalate permission.

  <img width="705" height="146" alt="1-15  System-Host Based Attack CTF 2 files" src="https://github.com/user-attachments/assets/a0c90b06-04f2-406a-b34e-9f26f9ae0499" />

- Check strings in `welcome` file, and we can see it invoked and launched greetings

  <img width="639" height="592" alt="1-15  System-Host Based Attack CTF 2 welcome string" src="https://github.com/user-attachments/assets/4b9e9445-241f-4fdd-99dc-911fa245ac2b" />

- Remove `greetings` file and replace is with `/bin/bash`, and then ran `welcome` again. Now we've gained root permission

  <img width="709" height="267" alt="1-15  System-Host Based Attack CTF 2 escalated" src="https://github.com/user-attachments/assets/90fc05a9-29fc-41fa-8a41-fb1c1f8990e0" />

- Get the flag 4

  <img width="566" height="185" alt="1-15  System-Host Based Attack CTF 2 flag 4" src="https://github.com/user-attachments/assets/b382f8e0-8d94-4fc1-8d46-c4719d40c5a7" />

# Key Finds

- FLAG 1: 01062cf5b54243888888d601a4a47042
- FLAG 2: 3fc40d77032c430ca98ec5a60c936711
- FLAG 3: d73ce591c49543b9bd0d3b93e20bd196
- FLAG 4: e51403db84c94b5ebbf0acd399bc0d6a

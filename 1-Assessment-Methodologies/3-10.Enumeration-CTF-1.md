---
tags:
  - lab
  - ctf
  - red_team
  - enumeration
  - msfconsole
  - nmap
  - hydra
  - enum4linux
course: "[[_Hub - Penetration Testing Student]]"
module: Assessment Methodologies
topic: Enumeration
date: 2025-10-18
status: completed
---
# Objective

A Linux machine is accessible at **target.ine.local**. Identify the services running on the machine and capture the flags. The flag is an md5 hash format.

- **Flag 1:** There is a samba share that allows anonymous access. Wonder what's in there!
- **Flag 2:** One of the samba users have a bad password. Their private share with the same name as their username is at risk!
- **Flag 3:** Follow the hint given in the previous flag to uncover this one.
- **Flag 4:** This is a warning meant to deter unauthorized users from logging in.

**Note:** The wordlists located in the following directory will be useful:

- /root/Desktop/wordlists

# Walkthrough

- Ran `ifconfig` and `ping -c 1 demo.ine.local` commands to identify the network information of the attack machine and the victim machine. Confirmed:
	- The IP addresses of both the machines
	- The target machine is online and pingable
	- The machines are in the same subnet

  <img width="935" height="459" alt="3-10  Enumeration CTF 1 ifconfig" src="https://github.com/user-attachments/assets/1c36292f-f3c3-4cdc-b170-c5bf1f133d7b" />
  <img width="997" height="235" alt="3-10  Enumeration CTF 1 ping" src="https://github.com/user-attachments/assets/3381d5e5-5662-4d1f-b322-39441ea5755e" />

- Ran a fast initial port and service scan `nmap -sS -sV -F -T4 target.ine.local -oX target.xml`

  <img width="1158" height="401" alt="3-10  Enumeration CTF 1 nmap" src="https://github.com/user-attachments/assets/2628cfa9-9c33-4bb1-b493-07a95fcef140" />

- Launch and set up msfconsole initially.

  <img width="1347" height="660" alt="3-10  Enumeration CTF 1 msfconsole setup" src="https://github.com/user-attachments/assets/45a99e0a-2266-43ad-bee3-f7099d24c525" />

- We need to verify the smb service version with `auxiliary/scanner/smb/smb_version` module as fist step.

  <img width="1495" height="495" alt="3-10  Enumeration CTF 1 smb version" src="https://github.com/user-attachments/assets/38793d3a-4553-4d96-89d3-cf697a014703" />

- Then we gonna use `auxiliary/scanner/smb/smb_enumshares` module to check if there's any shares on the SMB server. Here we found two.

  <img width="1494" height="267" alt="3-10  Enumeration CTF 1 smb share" src="https://github.com/user-attachments/assets/8bd30ea5-5a67-417f-97d7-507caf2a80a4" />

- Next, we tried using `auxiliary/scanner/smb/smb_enumusers` module to enumerate any available users.

  <img width="1048" height="187" alt="3-10  Enumeration CTF 1 smb users" src="https://github.com/user-attachments/assets/263ba4df-2ba9-4663-88c3-a95f4181791c" />

- To ensure we enumerate all information we need use `enum4linux` for double check, `enum4linux -a target.ine.local`, which helped us find more users as below screenshot shows
  >[!WARNING]
  >    Heavily reply on single tool for enumeration can cause a failure lead by blind points of the tool

  <img width="1404" height="662" alt="3-10  Enumeration CTF 1 enum4linux" src="https://github.com/user-attachments/assets/280edf89-6297-4961-9696-b84a921dc449" />

- As we got the usernames from the previous step, we can store them under `/root/userlist.txt` and try `auxiliary/scanner/smb/smb_login` to do brute force against the usernames.

  <img width="1346" height="442" alt="3-10  Enumeration CTF 1 smb login" src="https://github.com/user-attachments/assets/d5b9ea89-31be-4c94-9df2-2b66a5e1b4a6" />

- Log into the SMB Server with the credential we got. Got the FLAG 2

  <img width="1227" height="604" alt="3-10  Enumeration CTF 1 Flag 2" src="https://github.com/user-attachments/assets/9d4f1ede-6d8c-4816-acff-2bd6598dbf13" />

- Write a customised bash script to check shares in the provided wordlist, which allow anonymous access:

  ```bash
		#!/bin/bash
		SHARE_LIST="/root/Desktop/wordlists/shares.txt"
		
		while IFS= read -r share; do
		  [[ -z "$share" || "$share" =~ ^# ]] && continue
		  CMD="smbclient \\\\\\\\target.ine.local\\\\$share -N -g -c 'exit'"
		  if eval "$CMD" &>/dev/null; then
		    echo "Command: $CMD"
		    echo "Connection to \\\\tagrte.ine.local\\\\$share successful"
		  else 
		    echo "[+] Failed to connect to \\\\target.ine.local\\\\$share"
		  fi
		done < "$SHARE_LIST"
  ```
  
- Ran the script and found the share

  <img width="671" height="102" alt="3-10  Enumeration CTF 1 smb anonymous access" src="https://github.com/user-attachments/assets/ff9c623f-b4a2-4cce-94d0-2223717600d9" />

- Get the FLAG1 by connecting to it

  <img width="1200" height="362" alt="3-10  Enumeration CTF 1 smb connection" src="https://github.com/user-attachments/assets/5ac555c2-d0f5-4f74-8234-a8dcf4483d17" />
  <img width="537" height="100" alt="3-10  Enumeration CTF 1 FLAG 1" src="https://github.com/user-attachments/assets/d2aaf6c5-72ed-477c-a914-7441232ca78e" />

- As the `flag2.txt` mentioned there's a FTP service running on the target host, we need to run a full port scan to find it, `nmap -Pn -sS -sV -p- T4 192.229.69.3 -oX target.xml` 

  <img width="1196" height="436" alt="3-10  Enumeration CTF 1 nmap 2" src="https://github.com/user-attachments/assets/bb5a9051-e88e-4bfc-88a7-0f9b4c296e58" />

- Go back msfconsole and use `auxiliary/scanner/ftp/anonymous` module to see if we can access to the FTP server

  <img width="837" height="152" alt="3-10  Enumeration CTF 1 ftp anonymous" src="https://github.com/user-attachments/assets/9aff0538-28bf-4e9a-a1a2-41f54770755f" />

- Now we gonna switch to hydra to do a brute force attack, `hydro -L /root/userlist.txt -P /root/Desktop/wordlists/unix_password.txt ftp://target.ine.local:5554`

  <img width="1485" height="232" alt="3-10  Enumeration CTF 1 ftp creds" src="https://github.com/user-attachments/assets/a90360d8-34c0-4f06-93aa-e93a53f8080b" />

- Access the FTP server and download the target file. Got the FLAG 3 from it.

  <img width="1494" height="652" alt="3-10  Enumeration CTF 1 FTP Login" src="https://github.com/user-attachments/assets/95398e62-560b-4621-9bdf-8c565238c835" />
  <img width="517" height="114" alt="3-10  Enumeration CTF 1 FLAG 3" src="https://github.com/user-attachments/assets/ec47e460-9a5b-4055-96ba-d288bcc5b977" />

- Finally, according to the lab instruction, we ssh to the target directly and get the FLAG 4, because it is the last service that we didn't play with yet.

  <img width="1026" height="700" alt="3-10  Enumeration CTF 1 FLAG 4" src="https://github.com/user-attachments/assets/1fb8ad9d-7bdf-47a8-bf29-40824468a879" />

# Key Finds

- FLAG1 {99c303af83494beeba648f9e50acc21b}
- FLAG2 {cd6e188e67f94872b81a12204e9a0ac0}
- FLAG3 {d654f4c0836d4b5c9908dc1fe64c6bfc}
- FLAG4 {86f338a4abda4e9990ebddedea0bb59d}
